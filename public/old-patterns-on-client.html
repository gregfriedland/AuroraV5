<!DOCTYPE html>
<html>
<head>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.2.min.js"></script>
<!--<script src="http://js.leapmotion.com/leap-0.6.2.js"></script>-->
<script type="text/javascript" src="http://js.leapmotion.com/0.2.0-beta1/leap.min.js"></script>
<script src="kuler.js"></script>
<script src="palette.js"></script>
<script src="leds.js"></script>
<script src="patterns.js"></script>
</head>

<body>
<div id="connectionStatus"></div>
<div id="leap"></div>
<div id="palettes"></div>
<script type="text/javascript">

var numColors = 1024;
var numLeds = 104;
var leapUpdateInterval = 100;

//function getWaitTime(val, min, max) {
//  var expBase = Math.pow(Math.pow(10, Math.log(max-min)), 1/255.0);
//  
//  return min + Math.pow(expBase, val);
//}


// Connect to a Fadecandy server running on the same computer, on the default port
// Put some connection status text in the corner of the screen
var anim;
var socket = new WebSocket('ws://10.0.1.77:7890');
$('#connectionStatus').text('Connecting to fcserver...');
socket.onclose = function(event) {
    $('#connectionStatus').text('Not connected to fcserver');
}
socket.onopen = function(event) {
    $('#connectionStatus').text('Connected');
    
    paletteMgr = new PaletteManager(allBaseColors, numColors);
    drawPalettes(paletteMgr, null, 256, 3000);

    // gradient transition
    anim = new Animator(numLeds, paletteMgr,
                        function(leds) { updateLEDs(socket, leds); },
                        drawGradient,
                        {index: 0}, {delay: 20, incr: 1});

//    anim = new Animator(numLeds, paletteMgr,
//                        function(leds) { updateLEDs(socket, leds); },
//                        drawWipe,
//                        {index: 0}, {delay: 20, incr: 1});

//    anim = new Animator(numLeds, paletteMgr,
//                        function(leds) { updateLEDs(socket, leds); },
//                        drawPulse,
//                        {colorIndex: 0, pulseIndex: 0},
//                        {delay: 20, colorIncr: 5});

    anim.run();
}

var lastLeapUpdate = new Date().getTime();
Leap.loop(function(frame) {
//Leap.loop({}, function(frame) {
  var currTime = new Date().getTime();
  if (currTime - lastLeapUpdate < leapUpdateInterval) {
    return;
  }
  
  lastLeapUpdate = currTime;
  
  var frameString = "Hands: " + frame.hands.length + "<br />"
                + "Fingers: " + frame.fingers.length + "<br />"
                + "Tools: " + frame.tools.length + "<br />"
                + "Gestures: " + frame.gestures.length + "<br />";
  if (frame.fingers.length > 0) {
    var indexIncr = Math.floor(frame.fingers[0].tipPosition[0] / 20);
    //anim.updateIndexFunc = makeIndexIncrementFunc(indexIncr, numLeds);
    anim.config.incr = indexIncr;

    frameString += "Finger1: " + frame.fingers[0].tipPosition + "<br/>"
                 + "IndexIncr: " + indexIncr;
  }
        
  var leapTxt = document.getElementById('leap');
  leapTxt.innerHTML = frameString;
});


</script>
</body>
</html>
